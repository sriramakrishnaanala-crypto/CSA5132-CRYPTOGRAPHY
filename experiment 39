#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <stdlib.h>

#define MAX 1000
#define MAX_KEYS 26

// Structure to hold candidates
struct Candidate {
    char text[MAX];
    int key;
    int score;
};

// Simple English scoring
int scoreText(char *text) {
    int score = 0;
    for(int i = 0; text[i]; i++) {
        char ch = toupper(text[i]);
        if(strchr("ETAOIN", ch))   // common letters
            score++;
    }
    return score;
}

// Decrypt using Caesar key
void decrypt(char *cipher, int key, char *result) {
    for(int i = 0; cipher[i]; i++) {
        if(isupper(cipher[i]))
            result[i] = ((cipher[i] - 'A' - key + 26) % 26) + 'A';
        else if(islower(cipher[i]))
            result[i] = ((cipher[i] - 'a' - key + 26) % 26) + 'a';
        else
            result[i] = cipher[i];
    }
    result[strlen(cipher)] = '\0';
}

// Compare function for sorting
int compare(const void *a, const void *b) {
    return ((struct Candidate*)b)->score -
           ((struct Candidate*)a)->score;
}

int main() {

    char cipher[MAX];
    int topN;

    printf("Enter ciphertext:\n");
    fgets(cipher, sizeof(cipher), stdin);

    printf("Enter number of top results: ");
    scanf("%d", &topN);

    struct Candidate results[MAX_KEYS];

    // Try all 26 keys
    for(int k = 0; k < 26; k++) {
        decrypt(cipher, k, results[k].text);
        results[k].key = k;
        results[k].score = scoreText(results[k].text);
    }

    // Sort by likelihood
    qsort(results, MAX_KEYS,
          sizeof(struct Candidate), compare);

    printf("\nTop Possible Plaintexts:\n");

    for(int i = 0; i < topN && i < 26; i++) {
        printf("\nRank %d (Key = %d, Score = %d):\n%s\n",
               i+1,
               results[i].key,
               results[i].score,
               results[i].text);
    }

    return 0;
}
